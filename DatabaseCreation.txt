CREATE DATABASE GymManagement;
USE GymManagement;

-- Admin Table
CREATE TABLE Admin (
    AdminID INT AUTO_INCREMENT PRIMARY KEY,
    Username VARCHAR(50) NOT NULL UNIQUE,
    Password VARCHAR(255) NOT NULL
);

-- Gym Table
CREATE TABLE Gym (
    GymID INT AUTO_INCREMENT PRIMARY KEY,
    GymName VARCHAR(100) NOT NULL, 
    Location VARCHAR(255) NOT NULL, 
    ContactInfo VARCHAR(100) NOT NULL,
    AdminID INT,
    FOREIGN KEY (AdminID) REFERENCES Admin(AdminID) ON DELETE SET NULL
);

-- Member Table
CREATE TABLE Member (
    MemberID INT AUTO_INCREMENT PRIMARY KEY,
    FName VARCHAR(20) NOT NULL,
    MName VARCHAR(20),
    LName VARCHAR(20) NOT NULL,
    DOB DATE NOT NULL,
    Age INT GENERATED ALWAYS AS (TIMESTAMPDIFF(YEAR, DOB, CURDATE())) STORED,
    EmailID VARCHAR(50) UNIQUE NOT NULL,
    PhoneNumber VARCHAR(15) UNIQUE NOT NULL,
    Address TEXT,
    GymID INT,
    FOREIGN KEY (GymID) REFERENCES Gym(GymID) ON DELETE CASCADE
);

-- Fees Paid Table
CREATE TABLE FeesPaid (
    PaymentID INT AUTO_INCREMENT PRIMARY KEY,
    MemberID INT,
    PlanDuration VARCHAR(20) NOT NULL,
    Amount DECIMAL(10,2) NOT NULL,
    PaymentReceipt VARCHAR(255),
    FOREIGN KEY (MemberID) REFERENCES Member(MemberID) ON DELETE CASCADE
);

-- Equipment Table
CREATE TABLE Equipment (
    EquipmentID INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(100) NOT NULL,
    Type VARCHAR(50) NOT NULL,
    Status ENUM('Available', 'In Use', 'Under Maintenance') NOT NULL,
    GymID INT,
    FOREIGN KEY (GymID) REFERENCES Gym(GymID) ON DELETE CASCADE
);

-- Staff Table
CREATE TABLE Staff (
    StaffID INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(100) NOT NULL,
    Salary DECIMAL(10,2) NOT NULL,
    PhoneNumber VARCHAR(15) UNIQUE NOT NULL,
    GymID INT,
    FOREIGN KEY (GymID) REFERENCES Gym(GymID) ON DELETE CASCADE
);

-- Membership Plan Table
CREATE TABLE MembershipPlan (
    PlanID INT AUTO_INCREMENT PRIMARY KEY,
    PlanType VARCHAR(50) NOT NULL,
    Duration INT NOT NULL, -- Duration in months
    Fees DECIMAL(10,2) NOT NULL
);

-- Subscription Table (Mapping Member to Membership Plan)
CREATE TABLE Subscription (
    SubscriptionID INT AUTO_INCREMENT PRIMARY KEY,
    MemberID INT,
    PlanID INT,
    FOREIGN KEY (MemberID) REFERENCES Member(MemberID) ON DELETE CASCADE,
    FOREIGN KEY (PlanID) REFERENCES MembershipPlan(PlanID) ON DELETE CASCADE
);
